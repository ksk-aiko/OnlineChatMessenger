# OnlineChatMessenger

## 目的
クライアントがサーバに接続する形式のチャットメッセンジャーサービスを作成します。サーバはバックグラウンドで稼働し、クライアントはCLIを通じてサーバに接続します。接続が確立された後、クライアントはメッセージを入力してサーバに送り、そのメッセージはサーバに接続している他の全てのクライアントにも配信されます。

## 機能要件

1. **サーバの起動と待受**
   - サーバはCLIで起動し、バックグラウンドで着信接続を待ち受ける。
   - サーバがオフラインの場合、チャットサービス自体が停止する。

2. **通信プロトコル**
   - サーバとクライアントは、UDPネットワークソケットを使ってメッセージのやり取りをする。
   - 一度に最大4096バイトのメッセージを処理する。これはクライアントが送信できるメッセージの最大サイズであり、同様に最大4096バイトのメッセージが他の全クライアントに転送される。

3. **ユーザー認証**
   - セッションが開始される際、クライアントはユーザーにユーザー名を入力させる。

4. **メッセージ送信プロトコル**
   - メッセージの最初の1バイト、`usernamelen` はユーザー名の全バイトサイズを示し、最大で255バイト。
   - サーバはこの初めの`usernamelen`バイトを読み、送信者のユーザー名を特定する。その後のバイトは送信される実際のメッセージ。
   - バイトデータはUTF-8でエンコードおよびデコードされる。

5. **リレーシステム**
   - サーバにはリレーシステムが組み込まれており、現在接続中のすべてのクライアントの情報を一時的にメモリ上に保存する。
   - 新しいメッセージがサーバに届くと、そのメッセージは現在接続中の全クライアントにリレーされる。

6. **クライアントの削除**
   - クライアントは何回か連続で失敗するか、しばらくメッセージを送信していない場合、自動的にリレーシステムから削除される。
   - UDPはコネクションレスであるため、各クライアントの最後のメッセージ送信時刻を追跡する必要がある。

## 非機能要件

1. **リアルタイム性**
   - チャットメッセージングシステムは、リアルタイムのデータの優先度が信頼できるデータよりも高い。

2. **パフォーマンス**
   - システムは毎秒最低で10,000パケットの送信をサポートする必要がある。
   - 例えば、1000人が一つのチャットルームにいる場合、システムは毎秒最低でも10メッセージを処理できるように設計されているべきである。
   - 一般的なハードウェアでこの条件を満たすことが可能。

